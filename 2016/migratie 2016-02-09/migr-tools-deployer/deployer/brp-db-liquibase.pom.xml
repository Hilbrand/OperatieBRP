<?xml version="1.0"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">

   <modelVersion>4.0.0</modelVersion>

   <groupId>nl.bzk.migratiebrp.isc.deploy</groupId>
   <artifactId>migr-isc-deploy-brp-db-liquibase</artifactId>
   <name>Migr - ISC - Deploy - Deploy BRP DB Liquibase</name>
   <version>1.0</version>
   <packaging>pom</packaging>
	<parent>
		<groupId>nl.bzk.migratiebrp.isc.deploy</groupId>
		<artifactId>migr-isc-deploy-properties</artifactId>
		<version>1.0</version>
		<relativePath>./deploy-properties.pom.xml</relativePath>
	</parent>
 
	<dependencies>
        <dependency>
            <groupId>nl.bzk.brp.algemeen.opslag</groupId>
            <artifactId>brp-algemeen-opslag-database</artifactId>
            <version>${brp.database.version}</version>
        </dependency>
		
		<dependency>
			<!-- dependency nodig voor volgorde van projecten -->
			<groupId>nl.bzk.migratiebrp.build</groupId>
			<artifactId>migr-build-latestsnapshot</artifactId>
			<version>LATEST</version>
			<scope>provided</scope>
		</dependency>		
	</dependencies>
	
	<build>
		<plugins>
			<plugin>
				<groupId>org.codehaus.mojo</groupId>
				<artifactId>properties-maven-plugin</artifactId>
				<version>1.0-alpha-2</version>
				<executions>
				   <execution>
					  <phase>initialize</phase>
					  <goals>
						 <goal>read-project-properties</goal>
					  </goals>
					  <configuration>
						 <files>
							<file>${deploy.propfile}</file>
						 </files>
					  </configuration>
				   </execution>
				</executions>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-enforcer-plugin</artifactId>
				<version>1.4.1</version>
				<dependencies>
					<dependency>
						<groupId>nl.bzk.migratiebrp.build</groupId>
						<artifactId>migr-build-latestsnapshot</artifactId>
						<version>LATEST</version>
					</dependency>
				</dependencies>
				<executions>
					<execution>
						<id>enforce</id>
						<configuration>
							<rules>
								<latestSnapshotRule implementation="nl.bzk.migratiebrp.build.latestsnapshot.LatestSnapshotRule">
									<groupId>nl.bzk.brp.algemeen.opslag</groupId>
									<artifactId>brp-algemeen-opslag-database</artifactId>
								</latestSnapshotRule>
							</rules>
						</configuration>
						<goals>
							<goal>enforce</goal>
						</goals>
					</execution>
				</executions>
			</plugin>
		</plugins>
   </build>

   <profiles>
      <profile>
         <id>install</id>
         <activation>
            <property>
               <name>deploy.target</name>
               <value>install</value>
            </property>
         </activation>
         <build>
            <plugins>
               <plugin>
                  <groupId>org.liquibase</groupId>
                  <artifactId>liquibase-maven-plugin</artifactId>
                  <version>${liquibase.version}</version>
                  <configuration>
                     <driver>org.postgresql.Driver</driver>
                     <url>${dburl}</url>
                     <username>${dbusername}</username>
                     <password>${dbpassword}</password>
                  </configuration>
                  <dependencies>
                     <dependency>
                        <groupId>nl.bzk.brp.algemeen.opslag</groupId>
                        <artifactId>brp-algemeen-opslag-database</artifactId>
                        <version>${brp.database.version}</version>
                     </dependency>
                  </dependencies>
                  <executions>
                     <execution>
                        <id>create-db-brp</id>
                        <phase>process-classes</phase>
                        <goals>
                           <goal>update</goal>
                        </goals>
                        <configuration>
                           <dropFirst>true</dropFirst>
                           <promptOnNonLocalDatabase>false</promptOnNonLocalDatabase>
                           <changeLogFile>changeset/brp-databases.xml</changeLogFile>
                        </configuration>
                     </execution>
                     <execution>
                        <id>create-db-afnemer</id>
                        <phase>process-classes</phase>
                        <goals>
                           <goal>update</goal>
                        </goals>
                        <configuration>
                           <dropFirst>true</dropFirst>
                           <promptOnNonLocalDatabase>false</promptOnNonLocalDatabase>
                           <changeLogFile>changeset/afnemervoorbeeld.xml</changeLogFile>
                        </configuration>
                     </execution>
                  </executions>
               </plugin>
               
               
               <plugin>
                 <groupId>org.codehaus.mojo</groupId>
                 <artifactId>sql-maven-plugin</artifactId>
                 <version>1.5</version>
                 <dependencies>
                   <!-- specify the dependent JDBC driver here -->
                   <dependency>
                     <groupId>postgresql</groupId>
                     <artifactId>postgresql</artifactId>
                     <version>9.1-901.jdbc4</version>
                   </dependency>
                 </dependencies>
                 <!-- common configuration shared by all executions -->
                 <configuration>
                     <driver>org.postgresql.Driver</driver>
                     <url>${dburl}</url>
                     <username>${dbusername}</username>
                     <password>${dbpassword}</password>
                     <!-- by default it will skip because this projects package-type is 'pom' -->
                     <forceMojoExecution>true</forceMojoExecution>
                 </configuration>
                 <executions>
                   <execution>
                     <phase>generate-test-sources</phase>
                     <goals>
                       <goal>execute</goal>
                     </goals>
                     <!-- specific configuration for this execution -->
                     <configuration>
					   <delimiterType>row</delimiterType>                    
                       <srcFiles>
                         <srcFile>migr-brp/sql/brp-aanvulling-op-liquibase.sql</srcFile>
                       </srcFiles>
                     </configuration>
                   </execution>
                 </executions>
               </plugin>
               
            </plugins>
         </build>
      </profile>
      
      <profile>
         <id>deinstall</id>
         <activation>
            <property>
               <name>deploy.target</name>
               <value>deinstall</value>
            </property>
         </activation>
         <build>
            <plugins>
            <plugin>
                 <groupId>org.codehaus.mojo</groupId>
                 <artifactId>sql-maven-plugin</artifactId>
                 <version>1.5</version>
                 <dependencies>
                   <!-- specify the dependent JDBC driver here -->
                   <dependency>
                     <groupId>postgresql</groupId>
                     <artifactId>postgresql</artifactId>
                     <version>9.1-901.jdbc4</version>
                   </dependency>
                 </dependencies>
                 <!-- common configuration shared by all executions -->
                 <configuration>
                     <driver>org.postgresql.Driver</driver>
                     <url>${dburl}</url>
                     <username>${dbusername}</username>
                     <password>${dbpassword}</password>
                     <!-- by default it will skip because this projects package-type is 'pom' -->
                     <forceMojoExecution>true</forceMojoExecution>
                 </configuration>
                 <executions>
                   <execution>
                     <phase>generate-test-sources</phase>
                     <goals>
                       <goal>execute</goal>
                     </goals>
                     <!-- specific configuration for this execution -->
                     <configuration>
                       <srcFiles>
                         <srcFile>migr-brp/sql/drop-schemas.sql</srcFile>
                       </srcFiles>
                     </configuration>
                   </execution>
                 </executions>
               </plugin>
            </plugins>
         </build>
      </profile>
   </profiles>
</project>
		
