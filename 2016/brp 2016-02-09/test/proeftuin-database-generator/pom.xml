<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>nl.bzk.brp</groupId>
        <artifactId>brp-parent</artifactId>
        <version>93</version>
    </parent>
    <groupId>nl.bzk.brp.test</groupId>
	<artifactId>brp-test-proeftuin-database-generator</artifactId>
	<packaging>jar</packaging>
	<name>BRP Test Proeftuin database generator</name>
    <version>94-SNAPSHOT</version>

	<properties>
        <brp.release.versie>93</brp.release.versie>
        <brp.proeftuin.distributie.versie>93</brp.proeftuin.distributie.versie>

        <maven.jdbc.driverClassName>org.postgresql.Driver</maven.jdbc.driverClassName>
        <dburl>jdbc:postgresql://localhost:5433/whitebox</dburl>
        <dbusername>brp</dbusername>
        <dbpassword>brp</dbpassword>

		<project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
		<maven.build.timestamp.format>dd-MM-yyyy HH:mm.ss</maven.build.timestamp.format>
		<timestamp>${maven.build.timestamp}</timestamp>
	</properties>

	<dependencies>
		<dependency>
			<groupId>commons-cli</groupId>
			<artifactId>commons-cli</artifactId>
			<version>1.2</version>
		</dependency>
		<dependency>
			<groupId>commons-collections</groupId>
			<artifactId>commons-collections</artifactId>
		</dependency>
		<dependency>
			<groupId>commons-io</groupId>
			<artifactId>commons-io</artifactId>
		</dependency>
		<dependency>
			<groupId>org.apache.commons</groupId>
			<artifactId>commons-lang3</artifactId>
		</dependency>

		<dependency>
			<groupId>ch.qos.logback</groupId>
			<artifactId>logback-classic</artifactId>
			<version>1.0.6</version>
		</dependency>

		<dependency>
			<groupId>org.slf4j</groupId>
			<artifactId>slf4j-api</artifactId>
		</dependency>

		<dependency>
			<groupId>net.sourceforge.jexcelapi</groupId>
			<artifactId>jxl</artifactId>
			<version>2.6.12</version>
		</dependency>

        <dependency>
            <groupId>org.postgresql</groupId>
            <artifactId>postgresql</artifactId>
            <version>${postgres.version}</version>
        </dependency>

        <dependency>
            <groupId>nl.bzk.brp.algemeen.opslag</groupId>
            <artifactId>brp-algemeen-opslag-database</artifactId>
            <version>${brp.release.versie}</version>
        </dependency>

        <dependency>
            <groupId>nl.bzk.brp.algemeen.opslag</groupId>
            <artifactId>brp-algemeen-opslag-database</artifactId>
            <version>${brp.release.versie}</version>
            <classifier>handmatige_database_setup</classifier>
            <type>zip</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>brp-proeftuin-distributie</artifactId>
            <version>${brp.proeftuin.distributie.versie}</version>
            <classifier>proeftuin-autaut</classifier>
            <type>zip</type>
        </dependency>
	</dependencies>

	<build>
		<resources>
			<resource>
				<directory>src/main/resources</directory>
				<filtering>true</filtering>
				<includes>
					<include>**/*.properties</include>
                    <include>**/version.txt</include>
				</includes>
			</resource>
            <resource>
                <directory>src/main/resources</directory>
                <filtering>false</filtering>
                <excludes>
                    <exclude>**/*.properties</exclude>
                    <exclude>**/version.txt</exclude>
                </excludes>
            </resource>
		</resources>
	</build>

    <profiles>
        <!-- Profile om de whitebox fillers sql files te maken -->
        <profile>
            <id>proeftuin-maak-sql</id>
            <activation>
                <activeByDefault>true</activeByDefault>
            </activation>
            <build>
                <plugins>
                    <!-- Maakt het mogelijk om via "mvn clean dependency:copy-dependencies"
                           de target/lib directory te vullen met de dependencies van dit project -->
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <configuration>
                            <outputDirectory>${project.build.directory}/lib</outputDirectory>
                        </configuration>
                        <executions>
                            <execution>
                                <id>unpack-sqls</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>unpack-dependencies</goal>
                                </goals>
                                <configuration>
                                    <includeArtifactIds>brp-db</includeArtifactIds>
                                    <includes>**/*.sql</includes>
                                    <outputDirectory>${project.build.directory}/brp-db</outputDirectory>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <version>1.2.1</version>
                        <executions>
                            <execution>
                                <!-- Maak een whiteboxfiller (small) voor 26 * 2 ambtenaren -->
                                <id>whiteboxfiller-small</id>
                                <phase>generate-test-resources</phase>
                                <goals>
                                    <goal>java</goal>
                                </goals>
                                <configuration>
                                    <mainClass>nl.bzk.brp.whitebox.vulling.WhiteBoxFiller</mainClass>
                                    <arguments>
                                        <argument>52</argument>
                                        <argument>whiteboxfiller-small.sql</argument>
                                        <argument>no-db-reset</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                            <execution>
                                <!-- Maak een whiteboxfiller voor 26^2 * 2 ambtenaren -->
                                <id>whiteboxfiller-large</id>
                                <phase>generate-test-resources</phase>
                                <goals>
                                    <goal>java</goal>
                                </goals>
                                <configuration>
                                    <mainClass>nl.bzk.brp.whitebox.vulling.WhiteBoxFiller</mainClass>
                                    <arguments>
                                        <argument>1352</argument>
                                        <argument>whiteboxfiller.sql</argument>
                                        <argument>no-db-reset</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <artifactId>maven-assembly-plugin</artifactId>
                        <executions>
                            <execution>
                                <phase>package</phase>
                                <goals>
                                    <goal>single</goal>
                                </goals>
                            </execution>
                        </executions>
                        <configuration>
                            <descriptors>
                                <descriptor>src/assemble/sql.xml</descriptor>
                            </descriptors>
                        </configuration>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-resources-plugin</artifactId>
                        <configuration>
                            <encoding>${project.build.sourceEncoding}</encoding>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <!-- Profile to build the database -->
        <profile>
            <id>proeftuin-init-db</id>
            <activation>
                <activeByDefault>false</activeByDefault>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.liquibase</groupId>
                        <artifactId>liquibase-maven-plugin</artifactId>
                        <configuration>
                            <driver>${maven.jdbc.driverClassName}</driver>
                            <url>${dburl}</url>
                            <username>${dbusername}</username>
                            <password>${dbpassword}</password>
                        </configuration>
                        <dependencies>
                            <dependency>
                                <groupId>nl.bzk.brp.algemeen.opslag</groupId>
                                <artifactId>brp-algemeen-opslag-database</artifactId>
                                <version>${brp.release.versie}</version>
                            </dependency>
                        </dependencies>
                        <executions>
                            <execution>
                                <id>create-db-whitebox</id>
                                <phase>process-test-resources</phase>
                                <goals>
                                    <goal>update</goal>
                                </goals>
                                <configuration>
                                    <dropFirst>true</dropFirst>
                                    <promptOnNonLocalDatabase>false</promptOnNonLocalDatabase>
                                    <changeLogFile>changeset/whitebox-start.xml</changeLogFile>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-compiler-plugin</artifactId>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <!-- Profile to add the db constraints -->
        <profile>
            <id>proeftuin-finish-db</id>
            <activation>
                <activeByDefault>false</activeByDefault>
            </activation>
            <build>
                <plugins>
                    <!-- Maakt het mogelijk om via "mvn clean dependency:copy-dependencies"
                           de target/lib directory te vullen met de dependencies van dit project -->
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <configuration>
                            <outputDirectory>${project.build.directory}/lib</outputDirectory>
                        </configuration>
                        <executions>
                            <execution>
                                <id>unpack-algemeen-opslag</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>unpack-dependencies</goal>
                                </goals>
                                <configuration>
                                    <includeArtifactIds>brp-algemeen-opslag-database,brp-proeftuin-distributie</includeArtifactIds>
                                    <includes>**/*.sql</includes>
                                    <outputDirectory>${project.build.directory}/brp-db/</outputDirectory>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.liquibase</groupId>
                        <artifactId>liquibase-maven-plugin</artifactId>
                        <configuration>
                            <driver>${maven.jdbc.driverClassName}</driver>
                            <url>${dburl}</url>
                            <username>${dbusername}</username>
                            <password>${dbpassword}</password>
                        </configuration>
                        <dependencies>
                            <dependency>
                                <groupId>nl.bzk.brp.algemeen.opslag</groupId>
                                <artifactId>brp-algemeen-opslag-database</artifactId>
                                <version>${brp.release.versie}</version>
                            </dependency>
                        </dependencies>
                        <executions>
                            <execution>
                                <id>finish-db</id>
                                <phase>process-test-classes</phase>
                                <goals>
                                    <goal>update</goal>
                                </goals>
                                <configuration>
                                    <promptOnNonLocalDatabase>false</promptOnNonLocalDatabase>
                                    <changeLogFile>changeset/finish-db.xml</changeLogFile>
                                </configuration>
                            </execution>
                            <execution>
                                <id>finish-db-proeftuin-autaut</id>
                                <phase>process-test-classes</phase>
                                <goals>
                                    <goal>update</goal>
                                </goals>
                                <configuration>
                                    <promptOnNonLocalDatabase>false</promptOnNonLocalDatabase>
                                    <changeLogFile>changeset/proeftuin-autaut.xml</changeLogFile>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-compiler-plugin</artifactId>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <!-- Profile to add the db constraints -->
        <profile>
            <id>proeftuin-finish-db-localhost</id>
            <activation>
                <activeByDefault>false</activeByDefault>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.liquibase</groupId>
                        <artifactId>liquibase-maven-plugin</artifactId>
                        <configuration>
                            <driver>${maven.jdbc.driverClassName}</driver>
                            <url>${dburl}</url>
                            <username>${dbusername}</username>
                            <password>${dbpassword}</password>
                        </configuration>
                        <dependencies>
                            <dependency>
                                <groupId>nl.bzk.brp.algemeen.opslag</groupId>
                                <artifactId>brp-algemeen-opslag-database</artifactId>
                                <version>${brp.release.versie}</version>
                            </dependency>
                        </dependencies>
                        <executions>
                            <execution>
                                <id>finish-db-localhost</id>
                                <phase>install</phase>
                                <goals>
                                    <goal>update</goal>
                                </goals>
                                <configuration>
                                    <promptOnNonLocalDatabase>false</promptOnNonLocalDatabase>
                                    <changeLogFile>changeset/localhost.xml</changeLogFile>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-compiler-plugin</artifactId>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>

	<scm>
		<connection>scm:svn:https://www.modernodam.nl/svn/brp-code/trunk/test/proeftuin-database-generator</connection>
	</scm>
</project>
