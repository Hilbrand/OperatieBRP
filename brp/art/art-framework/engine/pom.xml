<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>nl.bzk.brp.art.framework</groupId>
        <artifactId>brp-art-framework</artifactId>
        <version>96-SNAPSHOT</version>
    </parent>

    <artifactId>brp-art-framework-engine</artifactId>
    <packaging>jar</packaging>
    <name>BRP ART Framework - Engine</name>

    <properties>
        <engine.version>${project.artifactId}-${project.version}</engine.version>
        <svn.url>https://www.modernodam.nl/svn/brp-code/trunk/algemeen/algemeen-opslag/database</svn.url>

        <dburl>jdbc:postgresql://localhost/brp</dburl>
        <dbuser>brp</dbuser>
        <dbusername>${dbuser}</dbusername>
        <dbpassword>brp</dbpassword>
    </properties>


    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.spockframework</groupId>
                <artifactId>spock-core</artifactId>
                <version>${spock.version}</version>
            </dependency>
        </dependencies>
    </dependencyManagement>

    <dependencies>
        <dependency>
            <groupId>com.smartbear.soapui</groupId>
            <artifactId>soapui</artifactId>
            <version>4.6.3</version>
            <exclusions>

                <!-- These are mainly GUI artifacts not needed in the headless test runner-->
                <!-- TODO We might also want to remove: fife:rsyntaxtextarea.
                          It's included in prior versions (< 4.5.2) though -->

                <!-- Team dev -->

                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>jxbrowser</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>comfyj</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>winpack</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>xulrunner-windows</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>xulrunner-linux64</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>xulrunner-linux</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>xulrunner-mac</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>MozillaInterfaces</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>engine-gecko</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>engine-gecko15</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>engine-ie</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>engine-webkit</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>jniwrap</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>xulrunner15-mac</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>xulrunner15-windows</artifactId>
                </exclusion>

                <!-- JGoodies -->

                <exclusion>
                    <groupId>com.jgoodies</groupId>
                    <artifactId>forms</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>com.jgoodies</groupId>
                    <artifactId>looks</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>com.jgoodies</groupId>
                    <artifactId>binding</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
            <version>1.2.17</version>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.apache.poi</groupId>
            <artifactId>poi-ooxml</artifactId>
            <version>${poi.version}</version>
        </dependency>
        <dependency>
            <groupId>org.codehaus.groovy</groupId>
            <artifactId>groovy</artifactId>
            <version>${groovy.version}</version>
        </dependency>
        <dependency>
            <groupId>org.postgresql</groupId>
            <artifactId>postgresql</artifactId>
			<version>${postgres.version}</version>
        </dependency>
        <dependency>
            <groupId>jp.skypencil.java-diff-utils</groupId>
            <artifactId>diffutils</artifactId>
            <version>${diffutils.version}</version>
        </dependency>
        <dependency>
            <groupId>xmlunit</groupId>
            <artifactId>xmlunit</artifactId>
            <version>1.5</version>
        </dependency>
        <dependency>
            <groupId>org.perf4j</groupId>
            <artifactId>perf4j</artifactId>
            <version>0.9.16</version>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>com.carrotsearch</groupId>
            <artifactId>junit-benchmarks</artifactId>
            <version>0.7.2</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>com.h2database</groupId>
            <artifactId>h2</artifactId>
            <version>1.4.178</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.spockframework</groupId>
            <artifactId>spock-core</artifactId>
            <version>${spock.version}</version>
        </dependency>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.11</version>
            <scope>compile</scope>
        </dependency>
    </dependencies>

    <build>
        <pluginManagement>
            <plugins>
                <plugin>
                    <groupId>com.github.redfish4ktc.soapui</groupId>
                    <artifactId>maven-soapui-extension-plugin</artifactId>
                    <version>4.6.3</version>
                </plugin>
                <plugin>
                    <groupId>com.google.code.maven-replacer-plugin</groupId>
                    <artifactId>replacer</artifactId>
                    <version>1.5.2</version>
                </plugin>
                <plugin>
                    <groupId>org.codehaus.gmavenplus</groupId>
                    <artifactId>gmavenplus-plugin</artifactId>
                    <version>1.1</version>
                </plugin>
            </plugins>
        </pluginManagement>
        <plugins>
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>build-helper-maven-plugin</artifactId>
                <executions>
                    <execution>
                        <id>add-source</id>
                        <goals>
                            <goal>add-source</goal>
                        </goals>
                        <phase>generate-sources</phase>
                        <configuration>
                            <sources>
                                <source>${basedir}/src/main/lib</source>
                                <source>${basedir}/src/main/soapui</source>
                            </sources>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

            <plugin>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>3.1</version>
                <configuration>
                    <compilerId>groovy-eclipse-compiler</compilerId>
                    <source>${language-level}</source>
                    <target>${language-level}</target>
                </configuration>
                <dependencies>
                    <dependency>
                        <groupId>org.codehaus.groovy</groupId>
                        <artifactId>groovy-eclipse-compiler</artifactId>
                        <version>2.9.2-01</version>
                    </dependency>
                    <dependency>
                        <groupId>org.codehaus.groovy</groupId>
                        <artifactId>groovy-eclipse-batch</artifactId>
                        <version>2.4.3-01</version>
                    </dependency>
                </dependencies>
            </plugin>

            <plugin>
                <groupId>com.google.code.maven-replacer-plugin</groupId>
                <artifactId>replacer</artifactId>
                <executions>
                    <execution>
                        <id>insert-groovy-scripts</id>
                        <goals>
                            <goal>replace</goal>
                        </goals>
                        <phase>prepare-package</phase>
                        <configuration>
                            <file>${project.build.outputDirectory}/ART-soapui-project.xml</file>
                            <delimiters>
                                <delimiter>//</delimiter>
                            </delimiters>
                            <regex>false</regex>
                            <replacements>
                                <!-- Generation of code -->
                                <replacement>
                                    <token>CREATE_REQUEST_TEMPLATE</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Create_Request_Template_and_Fields_for_XLS.groovy</valueFile>
                                </replacement>

                                <!-- General -->
                                <replacement>
                                    <token>PROJECT_ONLOAD</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/project/ARTEngine_load.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>PROJECT_ONSAVE</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/project/ARTEngine_save.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>ENGINE_SETUP</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/testcase/Engine_setup.groovy</valueFile>
                                </replacement>

                                <!-- TestSteps -->
                                <replacement>
                                    <token>INIT_COUNTERS</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Init_Counters.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>LOOP_BEGIN</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Loop_Begin.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>EXCEL_TO_CONTROLVALUES</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Read_Excel_and_Write_Control_Values.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>ENABLE_DISABLE_STEPS</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Read_Control_Values_and_Disable_Enable_Steps.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>PREPARE_DATABASE</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Prepare_Database_Data.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>EXCEL_TO_DATASOURCE</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Read_Excel_and_Write_Datasource_Values.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>OVERSCHRIJF_VARIABELEN</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/OverschrijfVariabelen.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>PRE_QUERY</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Pre_Query.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>BUILD_REQUEST</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Build_Request.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>SOAP_TO_FILE</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Write_Request_and_Response_to_File.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>ASSERT_SOAP_REQUEST</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Assert_SOAP_Request.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>BUILD_JDBC_REQUEST</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Build_JDBC_Request.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>JDBC_RETRY</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/JDBC_retry_on_assert.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>ASSERT_JDBC_REQUEST</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Assert_JDBC_Request.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>JDBC_TO_FILE</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Write_SQL_Request_and_Response_to_File.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>SET_RESULTS</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Set_Assertion_Results.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>POST_QUERY</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Post_Query.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>LOOP_END</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Loop_End.groovy</valueFile>
                                </replacement>

                                <replacement>
                                    <token>WRITE_REPORTS</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Create_Excel_Report.groovy</valueFile>
                                </replacement>
                                <replacement>
                                    <token>WRITE_ARCHIVE</token>
                                    <valueFile>${basedir}/src/main/soapui/scripts/teststeps/Create_ActualResult_Zip.groovy</valueFile>
                                </replacement>
                            </replacements>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <artifactId>maven-resources-plugin</artifactId>
                <executions>
                    <execution>
                        <id>copy-lib</id>
                        <goals>
                            <goal>copy-resources</goal>
                        </goals>
                        <phase>generate-resources</phase>
                        <configuration>
                            <outputDirectory>${project.build.outputDirectory}/lib</outputDirectory>
                            <resources>
                                <resource>
                                    <filtering>false</filtering>
                                    <directory>${basedir}/src/main/lib</directory>
                                </resource>
                            </resources>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-jar-plugin</artifactId>
                <configuration>
                    <archive>
                        <index>true</index>
                        <manifest>
                            <addDefaultSpecificationEntries />
                        </manifest>
                        <manifestEntries>
                            <url>${svn.url}</url>
                            <version>${project.version}</version>
                            <project-name>${project.name}</project-name>
                            <artifactId>${project.artifactId}</artifactId>
                            <engineversion>${engine.version}</engineversion>
                        </manifestEntries>
                    </archive>
                    <excludes>
                        <exclude>lib/**/*.groovy</exclude>
                        <exclude>scripts/**</exclude>
                        <exclude>VoorbeeldScript/ActualResults/**</exclude>
                        <exclude>VoorbeeldScript/actualresults.zip</exclude>
                    </excludes>
                </configuration>
            </plugin>
        </plugins>
    </build>

    <scm>
        <connection>scm:svn:https://www.modernodam.nl/svn/brp-code/trunk/art/art-framework/engine</connection>
    </scm>

    <pluginRepositories>
        <pluginRepository>
            <id>eviwarePluginRepository</id>
            <url>http://www.eviware.com/repository/maven2/</url>
        </pluginRepository>
    </pluginRepositories>

    <profiles>
        <profile>
            <id>verify-groovy-scripts</id>
            <activation>
                <property>
                    <name>!skipTests</name>
                </property>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <artifactId>maven-surefire-plugin</artifactId>
                        <version>2.16</version>
                        <executions>
                            <execution>
                                <id>default-test</id>
                                <goals>
                                    <goal>test</goal>
                                </goals>
                                <configuration>
                                    <includes>
                                        <include>**/*Spec.*</include>
                                        <include>**/*Test.java</include>
                                        <include>**/*TestCase.java</include>
                                    </includes>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <profile>
            <id>test-run</id>
            <activation>
                <activeByDefault>false</activeByDefault>
                <property>
                    <name>run-ART</name>
                    <value>true</value>
                </property>
            </activation>
            <properties>
                <!-- ART Run properties -->
                <testScript>./VoorbeeldScript</testScript>
                <projectEnv>ART</projectEnv>
                <dataSetNaam>Data</dataSetNaam>
            </properties>
            <build>
                <plugins>
                    <plugin>
                        <groupId>com.smartbear.soapui</groupId>
                        <artifactId>soapui-maven-plugin</artifactId>
                        <version>4.6.3</version>
                        <configuration>
                            <!-- Negeer gefaalde testen, zodat build wel succesvol eindigt, tbv deployen artifacts -->
                            <testFailIgnore>true</testFailIgnore>
                            <printReport>true</printReport>
                            <exportAll>true</exportAll>
                            <outputFolder>${project.build.directory}/soapui</outputFolder>
                            <globalProperties>
                                <value>projectEnv=${projectEnv}</value>
                                <value>dataSetNaam=${dataSetNaam}</value>
                                <value>testScript=${testScript}</value>
                            </globalProperties>
                        </configuration>
                        <dependencies>
                            <dependency>
                                <groupId>org.postgresql</groupId>
                                <artifactId>postgresql</artifactId>
                                <version>${postgres.version}</version>
                            </dependency>
                            <dependency>
                                <groupId>jp.skypencil.java-diff-utils</groupId>
                                <artifactId>diffutils</artifactId>
                                <version>${diffutils.version}</version>
                            </dependency>
                            <dependency>
                                <groupId>org.perf4j</groupId>
                                <artifactId>perf4j</artifactId>
                                <version>0.9.16</version>
                            </dependency>
                            <dependency>
                                <groupId>xmlunit</groupId>
                                <artifactId>xmlunit</artifactId>
                                <version>1.5</version>
                            </dependency>
                        </dependencies>
                        <executions>
                            <execution>
                                <id>default-soapui-test</id>
                                <goals>
                                    <goal>test</goal>
                                </goals>
                                <phase>integration-test</phase>
                                <configuration>
                                    <projectFile>${project.build.outputDirectory}/ART-soapui-project.xml</projectFile>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <profile>
            <id>update-definitions</id>
            <activation>
                <activeByDefault>false</activeByDefault>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.codehaus.gmavenplus</groupId>
                        <artifactId>gmavenplus-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>update-soapui-definitions</id>
                                <goals>
                                    <goal>execute</goal>
                                </goals>
                                <phase>process-resources</phase>
                                <configuration>
                                    <properties>
                                        <property>
                                            <name>soapui_project</name>
                                            <value>${project.basedir}/src/main/resources/ART-soapui-project.xml</value>
                                        </property>
                                    </properties>
                                    <scripts>
                                        <script>file:///${project.basedir}/src/main/soapui/scripts/Update_SoapUi_Definitions.groovy</script>
                                    </scripts>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>com.google.code.maven-replacer-plugin</groupId>
                        <artifactId>replacer</artifactId>
                        <executions>
                            <execution>
                                <id>reinsert-cdata-tags</id>
                                <goals>
                                    <goal>replace</goal>
                                </goals>
                                <phase>process-resources</phase>
                                <configuration>
                                    <file>${basedir}/src/main/resources/ART-soapui-project.xml</file>
                                    <tokenValueMap>${basedir}/src/main/resources/tokenmap.properties</tokenValueMap>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <profile>
            <id>clear-definitions</id>
            <activation>
                <activeByDefault>false</activeByDefault>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.codehaus.gmavenplus</groupId>
                        <artifactId>gmavenplus-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>uncache-soapui-definitions</id>
                                <goals>
                                    <goal>execute</goal>
                                </goals>
                                <phase>clean</phase>
                                <configuration>
                                    <properties>
                                        <property>
                                            <name>soapui_project</name>
                                            <value>${project.basedir}/src/main/resources/ART-soapui-project.xml</value>
                                        </property>
                                    </properties>
                                    <scripts>
                                        <script>file:///${project.basedir}/src/main/soapui/scripts/Clear_SoapUi_Definitions.groovy</script>
                                    </scripts>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>com.google.code.maven-replacer-plugin</groupId>
                        <artifactId>replacer</artifactId>
                        <executions>
                            <execution>
                                <id>reinsert-cdata-tags</id>
                                <goals>
                                    <goal>replace</goal>
                                </goals>
                                <phase>clean</phase>
                                <configuration>
                                    <file>${basedir}/src/main/resources/ART-soapui-project.xml</file>
                                    <tokenValueMap>${basedir}/src/main/resources/tokenmap.properties</tokenValueMap>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

    </profiles>
</project>
